#!/usr/bin/env python
# -*- coding: utf-8 -*-

import logging
import Artus.Utility.logger as logger
log = logging.getLogger(__name__)

import re
import json
import copy
import Artus.Utility.jsonTools as jsonTools
import Kappa.Skimming.datasetsHelperTwopz as datasetsHelperTwopz
import importlib
import os

import HiggsAnalysis.KITHiggsToTauTau.data.ArtusConfigs.Includes.ArtusConfigUtility as ACU

def build_config(nickname, **kwargs):
  config = jsonTools.JsonDict()
  config["EventWeight"]="eventWeight"
  config["Channel"] = "TT"
  
  
  config["Quantities"] = []
  
  config["TauSpinnerSettingsPDF"] = "NNPDF31_nnlo_as_0118"
  config["TauSpinnerSettingsCmsEnergy"] = 13000.0
  config["TauSpinnerSettingsIpp"] = True
  config["TauSpinnerSettingsIpol"] = "2"
  config["TauSpinnerSettingsNonSM2"] = "0"
  config["TauSpinnerSettingsNonSMN"] = "0"
  config["TauSpinnerValidPdgIdsAndStatusCodes"] = [
			# "15:23", # Tau
			"15:2", # Tau
			# "22:1", # Gamma,
			"111:2", # PiZero,
			"211:1", # PiPlus,
			"321:1", # KPlus,
			"130:1", # KLong,
			"310:1", # KShort,
			"11:1", # Electron,
			"12:1", # NuE,
			"13:1", # Muon,
			"14:1", # NuMu,
			"16:1", # NuTau
		]
  if re.search("(HToTauTau|H2JetsToTauTau|Higgs)", nickname):
			config["TauSpinnerMixingAnglesOverPiHalf"] = [
				0.00,
				0.05,
				0.10,
				0.15,
				0.20,
				0.25,
				0.30,
				0.35,
				0.40,
				0.45,
				0.50,
				0.55,
				0.60,
				0.65,
				0.70,
				0.75,
				0.80,
				0.85,
				0.90,
				0.95,
				1.00
			]
  else:
			config["TauSpinnerMixingAnglesOverPiHalf"] = []

  if re.search("SM_(WH_ZH_TTH_|VBF|GluGlu|GluGluTo)HToTauTau", nickname):
			config["TauSpinnerMixingAnglesOverPiHalfSample"] = 0.0
  elif re.search("^(W(minus|plus)|Z|VBF|GluGlu|GluGluTo)HToTauTau", nickname):
			config["TauSpinnerMixingAnglesOverPiHalfSample"] = 0.0
  elif re.search("SUSY(BB|GluGlu|GluGluTo)HToTauTau", nickname):
			config["TauSpinnerMixingAnglesOverPiHalfSample"] = 1.0
  else:
			config["TauSpinnerMixingAnglesOverPiHalfSample"] = -1.0

  config["Quantities"].extend([
		"EventTauPnPi0s",
		"EventTauNnPi0s",
		"EventTauPnProngs",
		"EventTauNnProngs",
		"EventTauPE",
		"EventTauNE",
		"EventTauPvisE",
		"EventTauNvisE",
		"genbosonmass",
		"CosThetaN",
		"CosThetaP",
		"Omega",
		"genBoson1Daughter1GranddaughterPtCMZ",
		"genBoson1Daughter1GranddaughterPzCMZ",
		"genBoson1Daughter1GranddaughterEtaCMZ",
		"genBoson1Daughter1GranddaughterPhiCMZ",
		"genBoson1Daughter2GranddaughterPtCMZ",
		"genBoson1Daughter2GranddaughterPzCMZ",
		"genBoson1Daughter2GranddaughterEtaCMZ",
		"genBoson1Daughter2GranddaughterPhiCMZ",
		"genBoson1Daughter3GranddaughterPtCMZ",
		"genBoson1Daughter3GranddaughterPzCMZ",
		"genBoson1Daughter3GranddaughterEtaCMZ",
		"genBoson1Daughter3GranddaughterPhiCMZ",
		"genBoson1Daughter4GranddaughterPtCMZ",
		"genBoson1Daughter4GranddaughterPzCMZ",
		"genBoson1Daughter4GranddaughterEtaCMZ",
		"genBoson1Daughter4GranddaughterPhiCMZ",
		"genBoson2Daughter1GranddaughterPtCMZ",
		"genBoson2Daughter1GranddaughterPzCMZ",
		"genBoson2Daughter1GranddaughterEtaCMZ",
		"genBoson2Daughter1GranddaughterPhiCMZ",
		"genBoson2Daughter2GranddaughterPtCMZ",
		"genBoson2Daughter2GranddaughterPzCMZ",
		"genBoson2Daughter2GranddaughterEtaCMZ",
		"genBoson2Daughter2GranddaughterPhiCMZ",
		"genBoson2Daughter3GranddaughterPtCMZ",
		"genBoson2Daughter3GranddaughterPzCMZ",
		"genBoson2Daughter3GranddaughterEtaCMZ",
		"genBoson2Daughter3GranddaughterPhiCMZ",
		"genBoson2Daughter4GranddaughterPtCMZ",
		"genBoson2Daughter4GranddaughterPzCMZ",
		"genBoson2Daughter4GranddaughterEtaCMZ",
		"genBoson2Daughter4GranddaughterPhiCMZ",              
		"genBoson1DaughterPt",
		"genBoson1DaughterPz",
		"genBoson1DaughterEta",
		"genBoson1DaughterPhi",
		"genBoson1DaughterMass",
		"genBoson1DaughterCharge",
		"genBoson1DaughterEnergy",
		"genBoson1DaughterPdgId",
		"genBoson1DaughterStatus",
		"genBoson2DaughterPt",
		"genBoson2DaughterPz",
		"genBoson2DaughterEta",
		"genBoson2DaughterPhi",
		"genBoson2DaughterMass",
		"genBoson2DaughterEnergy",
		"genBoson2DaughterPdgId",
		"genBoson2DaughterStatus",
		"genBoson1DaughterGranddaughterSize",
		"genBoson1Daughter1GranddaughterPt",
		"genBoson1Daughter1GranddaughterPz",
		"genBoson1Daughter1GranddaughterEta",
		"genBoson1Daughter1GranddaughterPhi",
		"genBoson1Daughter1GranddaughterMass",
		"genBoson1Daughter1GranddaughterEnergy",
		"genBoson1Daughter1GranddaughterPdgId",
		"genBoson1Daughter1GranddaughterStatus",
		"genBoson1Daughter2GranddaughterPt",
		"genBoson1Daughter2GranddaughterPz",
		"genBoson1Daughter2GranddaughterEta",
		"genBoson1Daughter2GranddaughterPhi",
		"genBoson1Daughter2GranddaughterMass",
		"genBoson1Daughter2GranddaughterEnergy",
		"genBoson1Daughter2GranddaughterPdgId",
		"genBoson1Daughter2GranddaughterStatus",
		"genBoson1Daughter3GranddaughterPt",
		"genBoson1Daughter3GranddaughterPz",
		"genBoson1Daughter3GranddaughterEta",
		"genBoson1Daughter3GranddaughterPhi",
		"genBoson1Daughter3GranddaughterMass",
		"genBoson1Daughter3GranddaughterEnergy",
		"genBoson1Daughter3GranddaughterPdgId",
		"genBoson1Daughter3GranddaughterStatus",
		"genBoson1Daughter4GranddaughterPt",
		"genBoson1Daughter4GranddaughterPz",
		"genBoson1Daughter4GranddaughterEta",
		"genBoson1Daughter4GranddaughterPhi",
		"genBoson1Daughter4GranddaughterMass",
		"genBoson1Daughter4GranddaughterEnergy",
		"genBoson1Daughter4GranddaughterPdgId",
		"genBoson1Daughter4GranddaughterStatus",
		"genBoson2DaughterGranddaughterSize",
		"genBoson2Daughter1GranddaughterPt",
		"genBoson2Daughter1GranddaughterPz",
		"genBoson2Daughter1GranddaughterEta",
		"genBoson2Daughter1GranddaughterPhi",
		"genBoson2Daughter1GranddaughterMass",
		"genBoson2Daughter1GranddaughterEnergy",
		"genBoson2Daughter1GranddaughterPdgId",
		"genBoson2Daughter1GranddaughterStatus",
		"genBoson2Daughter2GranddaughterPt",
		"genBoson2Daughter2GranddaughterPz",
		"genBoson2Daughter2GranddaughterEta",
		"genBoson2Daughter2GranddaughterPhi",
		"genBoson2Daughter2GranddaughterMass",
		"genBoson2Daughter2GranddaughterEnergy",
		"genBoson2Daughter2GranddaughterPdgId",
		"genBoson2Daughter2GranddaughterStatus",
		"genBoson2Daughter3GranddaughterPt",
		"genBoson2Daughter3GranddaughterPz",
		"genBoson2Daughter3GranddaughterEta",
		"genBoson2Daughter3GranddaughterPhi",
		"genBoson2Daughter3GranddaughterMass",
		"genBoson2Daughter3GranddaughterEnergy",
		"genBoson2Daughter3GranddaughterPdgId",
		"genBoson2Daughter3GranddaughterStatus",
		"genBoson2Daughter4GranddaughterPt",
		"genBoson2Daughter4GranddaughterPz",
		"genBoson2Daughter4GranddaughterEta",
		"genBoson2Daughter4GranddaughterPhi",
		"genBoson2Daughter4GranddaughterMass",
		"genBoson2Daughter4GranddaughterEnergy",
		"genBoson2Daughter4GranddaughterPdgId",
		"genBoson2Daughter4GranddaughterStatus",
		"genBoson1Daughter2GranddaughterGrandGranddaughterSize",
		"genBoson1Daughter2Granddaughter1GrandGranddaughterPdgId",
		"genBoson1Daughter2Granddaughter1GrandGranddaughterStatus",
		"genBoson1Daughter2Granddaughter2GrandGranddaughterPdgId",
		"genBoson1Daughter2Granddaughter2GrandGranddaughterStatus",
		"genBoson1Daughter2Granddaughter3GrandGranddaughterPdgId",
		"genBoson1Daughter2Granddaughter3GrandGranddaughterStatus",
		"genBoson1Daughter2Granddaughter4GrandGranddaughterPdgId",
		"genBoson1Daughter2Granddaughter4GrandGranddaughterStatus",
		"genBoson1Daughter2Granddaughter5GrandGranddaughterPdgId",
		"genBoson1Daughter2Granddaughter5GrandGranddaughterStatus",
		"genBoson1Daughter2Granddaughter6GrandGranddaughterPdgId",
		"genBoson1Daughter2Granddaughter6GrandGranddaughterStatus",
		"genBoson2Daughter2GranddaughterGrandGranddaughterSize",
		"genBoson1DaughterEnergyCMZ",
		"genBoson2DaughterEnergyCMZ",
		"genBoson1Daughter1GranddaughterEnergyCMT",
		"genBoson1Daughter2GranddaughterEnergyCMT",
		"genBoson1Daughter3GranddaughterEnergyCMT",
		"genBoson1Daughter4GranddaughterEnergyCMT",
		"genBoson2Daughter1GranddaughterEnergyCMT",
		"genBoson2Daughter2GranddaughterEnergyCMT",
		"genBoson2Daughter3GranddaughterEnergyCMT",
		"genBoson2Daughter4GranddaughterEnergyCMT",
		"genBoson1Daughter1GranddaughterEnergyCMZ",
		"genBoson1Daughter2GranddaughterEnergyCMZ",
		"genBoson1Daughter3GranddaughterEnergyCMZ",
		"genBoson1Daughter4GranddaughterEnergyCMZ",
		"genBoson2Daughter1GranddaughterEnergyCMZ",
		"genBoson2Daughter2GranddaughterEnergyCMZ",
		"genBoson2Daughter3GranddaughterEnergyCMZ",
		"genBoson2Daughter4GranddaughterEnergyCMZ",
		"genBoson1Daughter1GranddaughterCosCMT",
		"genBoson1Daughter2GranddaughterCosCMT",
		"genBoson1Daughter3GranddaughterCosCMT",
		"genBoson1Daughter4GranddaughterCosCMT",
		"genBoson2Daughter1GranddaughterCosCMT",
		"genBoson2Daughter2GranddaughterCosCMT",
	 	"genBoson2Daughter3GranddaughterCosCMT",
    	"genBoson2Daughter4GranddaughterCosCMT",
		"generatorWeight",
		"genPVx",
		"genPVy",
		"genPVz",
		"genPhiStarCP",
		"genPhiStarCP_rho",
		"gen_posyTauL",
		"gen_negyTauL",
		"gen_yTau",
		"genPhiCP",
		"genPhiCPLab",
		"genPhiCP_rho",
		"genPhiStar",
		"genOStarCP",
		"genPhiStar_rho",
		"genPhi",
		"genOCP",
		"genPhi_rho",
		"TauMProngEnergy",
		"TauPProngEnergy",
		"Tau1OneProngsSize",
		"Tau2OneProngsSize",
		"Tau1DecayMode",
		"Tau2DecayMode",
		"genIP1x",
		"genIP1y",
		"genIP1z",
		"genIP2x",
		"genIP2y",
		"genIP2z",
		"genCosPsiPlus",
		"genCosPsiMinus",
		"OneProngChargedPart1PdgId",
		"OneProngChargedPart1Pt",
		"OneProngChargedPart1Pz",
		"OneProngChargedPart1Eta",
		"OneProngChargedPart1Phi",
		"OneProngChargedPart1Mass",
		"OneProngChargedPart1Energy",
		"OneProngChargedPart2PdgId",
		"OneProngChargedPart2Pt",
		"OneProngChargedPart2Pz",
		"OneProngChargedPart2Eta",
		"OneProngChargedPart2Phi",
		"OneProngChargedPart2Mass",
		"OneProngChargedPart2Energy",
		"genZPlus",
		"genZMinus",
		"genZs",
		"genPVx",
		"genPVy",
		"genPVz",
		"genPhiStarCP",
		"genPhiStarCP_rho",
		"gen_posyTauL",
		"gen_negyTauL",
		"gen_yTau",
		"genPhiCP",
		"genPhiCPLab",
		"genPhiCP_rho",
		"genPhiStar",
		"genOStarCP",
		"genPhiStar_rho",
		"genPhi",
		"genOCP",
		"genPhi_rho",
		"TauMProngEnergy",
		"TauPProngEnergy",
		"Tau1OneProngsSize",
		"Tau2OneProngsSize",
		"Tau1DecayMode",
		"Tau2DecayMode",
		"genIP1x",
		"genIP1y",
		"genIP1z",
		"genIP2x",
		"genIP2y",
		"genIP2z",
		"genCosPsiPlus",
		"genCosPsiMinus",
		"OneProngChargedPart1PdgId",
		"OneProngChargedPart1Pt",
		"OneProngChargedPart1Pz",
		"OneProngChargedPart1Eta",
		"OneProngChargedPart1Phi",
		"OneProngChargedPart1Mass",
		"OneProngChargedPart1Energy",
		"OneProngChargedPart2PdgId",
		"OneProngChargedPart2Pt",
		"OneProngChargedPart2Pz",
		"OneProngChargedPart2Eta",
		"OneProngChargedPart2Phi",
		"OneProngChargedPart2Mass",
		"OneProngChargedPart2Energy",
		"genZPlus",
		"genZMinus",
		"genZs",
		"tauSpinnerPolarisation",
		"tauSpinnerWeightSample",
		"tauSpinnerWeightInvSample",
		"tauSpinnerWeight",
		"genBoson1DaughternPi0",
		"genBoson2DaughternPi0",
		"genBoson1DaughternProngs",
		"genBoson2DaughternProngs"
	])
  config["Consumers"] = ["KappaLambdaNtupleConsumer",
                         "cutflow_histogram"]
  config["Processors"]=["producer:GenBosonFromGenParticlesProducer",
                "producer:GenBosonDiLeptonDecayModeProducer",
                "producer:ValidGenTausProducer",
                "producer:GenDiLeptonDecayModeProducer",
                "producer:GenParticleProducer",
                # "producer:RecoElectronGenParticleMatchingProducer",
                # "producer:RecoElectronGenTauMatchingProducer",
                # "producer:RecoMuonGenParticleMatchingProducer",
                # "producer:RecoMuonGenTauMatchingProducer",
                # "producer:RecoTauGenParticleMatchingProducer",
                # "producer:RecoTauGenTauMatchingProducer",
				"producer:TauSpinnerProducer",
                "producer:MatchedLeptonsProducer",
                "producer:GenTauDecayProducer",
				"producer:MyQuantitiesProducer",
                "producer:GenTauCPProducer"
	#   "producer:GenParticleProducer",
												# "producer:GenTauDecayProducer",
												# "producer:GenBosonFromGenParticlesProducer",
												# "producer:GenBosonDiLeptonDecayModeProducer",
												#"producer:GenBosonProductionProducer",
												# "producer:GenTauCPProducer"
												#"producer:GenMatchedTauCPProducer"
												]
  
  # pipelines - systematic shifts
  return ACU.apply_uncertainty_shift_configs('tt', config, importlib.import_module("HiggsAnalysis.KITHiggsToTauTau.data.ArtusConfigs.Run2MSSM2017.nominal").build_config(nickname)) 
        
